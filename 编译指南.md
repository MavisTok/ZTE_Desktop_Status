# ZTE Router Dashboard - 编译指南

## 🔧 问题修复说明

已修复所有编译错误,项目现在应该可以正常编译了！

### ✅ 已修复的问题

#### 1. C# 语言版本升级
- **问题**: CS8370 功能"可为 null 的引用类型"在 C# 7.3 中不可用
- **修复**: 已将 C# 语言版本升级到 8.0
- **位置**: `ZTE.csproj` 第 17 行
- **代码**: 添加了 `<LangVersion>8.0</LangVersion>`

#### 2. 可空引用类型语法修复
- **问题**: C# 7.3 不支持 `object?` 语法
- **修复**:
  - 移除了 `object?` 中的 `?` 标记 → `object`
  - 移除了 `!` 非空断言运算符
  - 修改了默认参数从 `null` 到 `""`
- **修改文件**:
  - `Api\UbusClient.cs` (第 49, 111, 121 行)
  - `ViewModels\ViewModelBase.cs` (第 13, 19 行)

#### 3. NuGet 包引用路径修正
- **问题**: CS0234 命名空间"System.Text"中不存在类型或命名空间名"Json"
- **修复**: 修正 HintPath 从 `..\packages\` 到 `packages\`
- **位置**: `ZTE.csproj` 第 41-64 行
- **影响**: 所有 8 个 NuGet 包引用

## 编译步骤

### 方法 1: 使用 Visual Studio (推荐)

1. **打开项目**
   ```
   用 Visual Studio 打开: E:\.NET Ly\ZTE\ZTE.csproj
   ```

2. **还原 NuGet 包**
   - 右键点击解决方案
   - 选择 "还原 NuGet 程序包"
   - 等待还原完成

3. **编译项目**
   - 按 `Ctrl + Shift + B` 或
   - 点击菜单 "生成" → "生成解决方案"

4. **运行**
   - 按 `F5` 开始调试运行

### 方法 2: 使用命令行

1. **还原 NuGet 包**
   ```bash
   cd "E:\.NET Ly\ZTE"
   dotnet restore
   ```

   或使用 NuGet.exe:
   ```bash
   nuget restore ZTE.csproj
   ```

2. **编译项目**
   ```bash
   msbuild ZTE.csproj /p:Configuration=Release
   ```

### 方法 3: 使用批处理脚本

双击运行 `InstallPackages.bat`,它会自动检测并安装 NuGet 包。

## 依赖的 NuGet 包

以下包会自动从 NuGet 下载:

- ✅ System.Text.Json (8.0.0)
- ✅ System.Buffers (4.5.1)
- ✅ System.Memory (4.5.5)
- ✅ System.Numerics.Vectors (4.5.0)
- ✅ System.Runtime.CompilerServices.Unsafe (6.0.0)
- ✅ System.Text.Encodings.Web (8.0.0)
- ✅ System.Threading.Tasks.Extensions (4.5.4)
- ✅ System.ValueTuple (4.5.0)

## 常见问题

### Q: 提示 "未能找到类型或命名空间名 JsonElement"

**解决方案:**
1. 确保已还原 NuGet 包
2. 在 Visual Studio 中清理并重新生成:
   - 右键项目 → "清理"
   - 右键项目 → "重新生成"

### Q: 提示 "功能在 C# 7.3 中不可用"

**解决方案:**
已在项目文件中添加 `<LangVersion>8.0</LangVersion>`,重新加载项目即可。

### Q: packages 文件夹不存在

**解决方案:**
NuGet 会自动创建 packages 文件夹,通常位于:
- 项目目录: `E:\.NET Ly\ZTE\packages\`
- 或解决方案目录: `E:\.NET Ly\packages\`

### Q: 编译成功但运行时报错

**解决方案:**
1. 检查 `AppSettings.cs` 中的配置
2. 确保路由器地址正确
3. 更新 Session Token

## 配置路由器连接

编译成功后,需要配置路由器信息:

### 1. 修改路由器地址

编辑 `AppSettings.cs` (第 13 行):
```csharp
public static string RouterUrl { get; set; } = "http://192.168.0.1";
```
改为你的路由器 IP 地址。

### 2. 获取 Session Token

1. 浏览器打开路由器管理页面
2. 按 F12 打开开发者工具
3. 切换到 Network (网络) 标签
4. 刷新页面
5. 找到 `/ubus/` 请求
6. 查看请求 Payload,复制 session 值

### 3. 更新 Session Token

编辑 `AppSettings.cs` (第 18 行):
```csharp
public static string SessionToken { get; set; } = "你的session值";
```

## 输出文件位置

编译成功后,可执行文件位于:

- **Debug 版本**: `E:\.NET Ly\ZTE\bin\Debug\ZTE.exe`
- **Release 版本**: `E:\.NET Ly\ZTE\bin\Release\ZTE.exe`

## 运行要求

- Windows 7 或更高版本
- .NET Framework 4.7.2 或更高版本
- 能够访问路由器管理页面

## 下一步

编译成功后,查看 `README.md` 了解详细使用说明。

---

如有问题,请查看项目目录中的其他文档:
- `README.md` - 使用说明
- `项目规划\项目实现总结.md` - 实现总结
- `项目规划\设计方案.md` - 原始设计方案
