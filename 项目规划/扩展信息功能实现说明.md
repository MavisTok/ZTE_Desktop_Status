# 扩展信息功能实现说明

## 概述
已成功实现扩展信息功能，在登录后获取更多的设备信息，并以卡片形式展示，类似主界面的 6 个模块。

## 实现的功能

### 1. 数据模型

创建了 3 个新的数据模型：

#### WifiDetailInfo (WiFi 详细信息)
- WiFi 总开关状态
- 2.4G SSID 名称和认证模式
- 5G SSID 名称和认证模式
- 2.4G/5G 射频状态（启用/禁用）
- 负载均衡（LBD）状态
- DFS 状态和加载状态

#### BatteryInfo (电池详细信息)
- 电池在线状态
- 电池电量百分比
- 充电器连接状态
- 充电状态（充电中/已连接/未连接）
- 电池温度和温度等级
- 充满所需时间
- 电量耗尽时间
- 电池模式
- 省电模式

#### PowerModeInfo (电源模式信息)
- 模块名称
- 直接供电模式启用状态

### 2. API 服务层

**ExtendedInfoService.cs** - 提供以下 API 调用：

1. `GetWifiDetailInfoAsync()` - 获取 WiFi 详细信息
   - API: `zwrt_wlan.report`

2. `GetBatteryInfoAsync()` - 获取电池详细信息
   - API: `zwrt_mc.device.manager.get_device_info`
   - 参数：12 个电池相关的信息字段

3. `GetPowerModeInfoAsync()` - 获取电源模式信息
   - API: `zwrt_deviceui.zwrt_deviceui_direct_power_mode_get`

4. `GetAllExtendedInfoAsync()` - 批量获取所有信息（性能优化）
   - 使用 UbusClient 的批量调用功能
   - 一次请求获取所有 3 个 API 的数据

### 3. ViewModel

**ExtendedInfoViewModel.cs** - 管理扩展信息页面的数据：

#### 属性分组

**WiFi 属性：**
- WifiStatus - WiFi 总开关状态
- Wifi2gSsid, Wifi2gAuthMode, Wifi2gStatus - 2.4G WiFi 信息
- Wifi5gSsid, Wifi5gAuthMode, Wifi5gStatus - 5G WiFi 信息
- LbdStatus - 负载均衡状态

**电池属性：**
- BatteryPercent - 电量百分比
- BatteryStatus - 电池状态
- BatteryTemperature - 电池温度
- ChargerStatus - 充电器状态
- TimeToEmpty - 电量耗尽时间
- TimeToFull - 充满所需时间
- BatteryMode - 电池模式

**电源属性：**
- PowerMode - 电源模式
- PowerModeModule - 模块名称

#### 功能特性

- **自动刷新**：每 3 秒自动刷新数据
- **数据格式化**：
  - 认证模式转换（sae-mixed → WPA3/WPA2 混合）
  - 时间格式化（分钟 → 小时+分钟）
  - 状态转换（1/0 → 启用/禁用、已开启/已关闭）
- **批量加载**：使用批量 API 调用提升性能
- **错误处理**：完善的异常处理和用户提示

### 4. 用户界面

**ExtendedInfoWindow.xaml** - 扩展信息窗口：

#### 布局设计（2 行 × 3 列卡片）

**第一行：WiFi 信息**
1. WiFi 状态卡片
   - WiFi 总开关
   - 负载均衡状态

2. 2.4G WiFi 卡片
   - SSID 名称
   - 认证模式
   - 启用状态

3. 5G WiFi 卡片
   - SSID 名称
   - 认证模式
   - 启用状态

**第二行：电池和电源信息**
4. 电池状态卡片
   - 电量百分比（大字号显示）
   - 电池在线状态
   - 电池温度

5. 充电信息卡片
   - 充电器状态
   - 充满所需时间
   - 电量耗尽时间
   - 电池模式

6. 电源模式卡片
   - 当前电源模式
   - 模块名称

#### 界面特点

- **响应式卡片布局**：每个卡片有白色背景、圆角边框
- **颜色编码**：
  - 蓝色 (#2196F3)：标题和主要信息
  - 绿色 (#4CAF50)：正常状态、电量显示
  - 橙色 (#FF9800)：温度信息
  - 紫色 (#9C27B0)：电源模式
- **实时更新**：显示最后更新时间
- **手动刷新**：提供刷新按钮
- **状态栏**：显示连接状态和错误信息

### 5. 主窗口集成

**更新内容：**
- 主窗口头部的按钮从 "📋 JSON-RPC 数据" 改为 "📊 扩展信息"
- 点击按钮打开扩展信息窗口
- 传递 UbusClient 实例到新窗口，使用相同的会话

## 文件清单

### 新增文件
1. **Models/**
   - `BatteryInfo.cs` - 电池信息模型
   - `WifiDetailInfo.cs` - WiFi 详细信息模型
   - `PowerModeInfo.cs` - 电源模式信息模型

2. **Services/**
   - `ExtendedInfoService.cs` - 扩展信息服务

3. **ViewModels/**
   - `ExtendedInfoViewModel.cs` - 扩展信息视图模型

4. **窗口文件**
   - `ExtendedInfoWindow.xaml` - 扩展信息窗口界面
   - `ExtendedInfoWindow.xaml.cs` - 窗口代码逻辑

### 修改文件
1. `MainWindow.xaml` - 更新按钮文本和点击事件
2. `MainWindow.xaml.cs` - 保存 UbusClient 引用，实现按钮点击事件
3. `ZTE.csproj` - 添加所有新文件的引用

## API 调用说明

### 1. WiFi 详细信息 API
```json
// Request
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "call",
  "params": ["session_token", "zwrt_wlan", "report", {}]
}

// Response
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": [0, {
    "wifi_onoff": "1",
    "main2g_ssid": "ZTE",
    "main2g_authmode": "sae-mixed",
    "main5g_ssid": "ZTE",
    "main5g_authmode": "sae-mixed",
    "radio2": "wifi0",
    "radio5": "wifi1",
    "radio2_disabled": "0",
    "radio5_disabled": "0",
    "lbd_enable": "1",
    ...
  }]
}
```

### 2. 电池信息 API
```json
// Request
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "call",
  "params": ["session_token", "zwrt_mc.device.manager", "get_device_info", {
    "deviceInfoList": [
      "bat_online", "bat_percent", "bat_charger_connect",
      "bat_charger_status", "bat_temperature", ...
    ]
  }]
}

// Response
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": [0, {
    "bat_online": "1",
    "bat_percent": "44",
    "bat_charger_connect": "0",
    "bat_charger_status": "0",
    "bat_temperature": "32",
    "bat_time_to_empty": "583",
    ...
  }]
}
```

### 3. 电源模式 API
```json
// Request
{
  "jsonrpc": "2.0",
  "id": 3,
  "method": "call",
  "params": ["session_token", "zwrt_deviceui", "zwrt_deviceui_direct_power_mode_get", {
    "moduleName": "web"
  }]
}

// Response
{
  "jsonrpc": "2.0",
  "id": 3,
  "result": [0, {
    "moduleName": "zte_topsw_devui",
    "enable": "0"
  }]
}
```

## 使用方法

1. **启动应用程序**
   - 应用会自动登录（使用配置的 Session Token）
   - 主窗口显示 6 个基础信息卡片

2. **查看扩展信息**
   - 点击主窗口右上角的 "📊 扩展信息" 按钮
   - 打开扩展信息窗口
   - 自动加载并显示所有扩展信息

3. **数据刷新**
   - 数据每 3 秒自动刷新
   - 也可点击 "🔄 刷新" 按钮手动刷新
   - 右上角显示最后更新时间

## 技术特点

1. **性能优化**
   - 使用批量 API 调用（BatchCallAsync）
   - 3 个 API 调用合并为 1 次 HTTP 请求
   - 减少网络延迟和服务器负载

2. **数据绑定**
   - MVVM 架构
   - 完整的属性变更通知（INotifyPropertyChanged）
   - 实时 UI 更新

3. **用户体验**
   - 自动刷新，无需手动操作
   - 清晰的卡片布局
   - 友好的数据格式化
   - 完善的错误提示

4. **代码复用**
   - 复用 UbusClient 的会话
   - 复用主窗口的 API 客户端
   - 统一的错误处理机制

## 与主窗口的对比

### 主窗口（基础信息）
- 网络状态（IPv4/IPv6）
- 实时速度（上传/下载）
- 流量统计（今日/本月/总计）
- SIM 卡信息（运营商/ICCID）
- 信号强度（网络类型/频段/信号质量）
- 设备数量（无线/有线）

### 扩展信息窗口（详细信息）
- WiFi 详细配置（SSID/认证模式/射频状态）
- 电池详细状态（电量/温度/充电时间）
- 电源模式信息（供电模式/模块）

两个窗口互补，提供完整的设备监控功能。

## 注意事项

1. **会话要求**
   - 扩展信息需要有效的登录会话
   - 使用与主窗口相同的 Session Token
   - 如果会话过期，需要重新登录

2. **API 权限**
   - 某些 API 可能需要管理员权限
   - 未登录状态下 API 调用会失败

3. **数据准确性**
   - 数据来自设备实时报告
   - 某些数据可能因设备状态不同而不可用
   - 使用 "N/A" 表示不可用的数据

4. **性能考虑**
   - 3 秒刷新间隔是平衡实时性和性能的结果
   - 可根据需要调整刷新间隔
   - 批量调用减少了网络开销

## 未来扩展

可以继续添加的信息：
- 连接设备详细列表
- 端口转发规则
- 防火墙状态
- DDNS 配置
- VPN 状态
- 系统日志
- 更多设备硬件信息
