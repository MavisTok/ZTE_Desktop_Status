# ZTE Router Dashboard - 项目实现总结

## 项目概述

已成功实现一个完整的 ZTE 路由器监控 WPF 应用程序,采用 MVVM 架构模式,通过 ubus JSON-RPC 接口实时监控路由器状态。

## 已实现功能

### ✅ 核心功能

1. **实时数据监控**
   - 网络连接状态 (IPv4/IPv6)
   - 上传/下载速度实时显示
   - 流量统计 (今日/本月/总计)
   - SIM 卡信息
   - 5G/4G 信号强度
   - 连接设备统计

2. **自动刷新机制**
   - 默认每 2 秒批量请求所有数据
   - 可配置刷新间隔
   - UI 线程安全

3. **数据格式化**
   - 速率自动转换单位 (B/s → KB/s → MB/s → GB/s)
   - 流量自动转换单位 (B → KB → MB → GB → TB)
   - 敏感信息脱敏显示 (ICCID)

### ✅ 技术实现

#### 1. 项目结构

```
ZTE/
├── Api/
│   ├── UbusClient.cs           - Ubus JSON-RPC 客户端 ✅
│   └── SessionManager.cs       - Session 管理器 ✅
├── Models/
│   ├── SpeedStat.cs            - 速率和流量模型 ✅
│   ├── SimInfo.cs              - SIM 卡信息模型 ✅
│   ├── NetInfo.cs              - 网络信号模型 ✅
│   ├── DeviceCount.cs          - 设备统计模型 ✅
│   ├── WifiReport.cs           - WiFi 配置模型 ✅
│   └── WanStatus.cs            - WAN 状态模型 ✅
├── Services/
│   └── HomeDashboardService.cs - 仪表盘数据服务 ✅
├── ViewModels/
│   ├── ViewModelBase.cs        - ViewModel 基类 ✅
│   └── DashboardViewModel.cs   - 仪表盘 ViewModel ✅
├── Utils/
│   └── FormatUtil.cs           - 格式化工具类 ✅
├── AppSettings.cs              - 应用配置 ✅
├── MainWindow.xaml             - 主界面 UI ✅
├── MainWindow.xaml.cs          - 主界面代码 ✅
├── README.md                   - 使用说明 ✅
└── packages.config             - NuGet 依赖 ✅
```

#### 2. 核心类说明

**UbusClient.cs** (E:\.NET Ly\ZTE\Api\UbusClient.cs)
- JSON-RPC 2.0 客户端实现
- 支持批量请求
- 自动处理响应错误码

**HomeDashboardService.cs** (E:\.NET Ly\ZTE\Services\HomeDashboardService.cs)
- 批量获取 6 个 ubus 接口数据 (id: 46, 47, 48, 51, 53, 55)
- 自动解析为强类型模型

**DashboardViewModel.cs** (E:\.NET Ly\ZTE\ViewModels\DashboardViewModel.cs)
- 实现 MVVM 数据绑定
- 管理自动刷新定时器
- 格式化显示数据

**MainWindow.xaml** (E:\.NET Ly\ZTE\MainWindow.xaml)
- 6 个仪表盘卡片布局
- Material Design 风格
- 响应式设计

#### 3. API 接口映射

| ID | Ubus 调用 | 用途 | 模型类 |
|----|-----------|------|--------|
| 46 | zwrt_data.get_wwandst | 速率和流量统计 | SpeedStat |
| 47 | zwrt_data.getbasicinfo | SIM 卡信息 | SimInfo |
| 48 | zwrt_data.get_nrinfo | 网络类型和信号 | NetInfo |
| 51 | zwrt_data.get_stanum | 设备数量 | DeviceCount |
| 53 | zwrt_wifi.get_reportwifi | WiFi 配置 | WifiReport |
| 55 | zwrt_data.get_wwaniface | WAN 接口状态 | WanStatus |

## 使用步骤

### 1. 还原 NuGet 包

```bash
cd "E:\.NET Ly\ZTE"
nuget restore
```

或在 Visual Studio 中:
- 右键解决方案 → "还原 NuGet 程序包"

### 2. 配置路由器信息

编辑 `AppSettings.cs` (E:\.NET Ly\ZTE\AppSettings.cs:13):

```csharp
public static string RouterUrl { get; set; } = "http://192.168.0.1";  // 修改为你的路由器地址
public static string SessionToken { get; set; } = "你的session值";      // 修改为实际 session
```

### 3. 获取 Session Token

1. 浏览器访问路由器管理页面
2. F12 打开开发者工具 → Network 标签
3. 查找 `/ubus/` 请求
4. 复制请求 payload 中的 session 值

### 4. 编译运行

- 按 F5 或点击"开始"按钮
- 应用会自动开始每 2 秒刷新数据

## 已安装依赖

以下 NuGet 包已配置在 `packages.config`:

- System.Text.Json (8.0.0) - JSON 序列化/反序列化
- System.Buffers (4.5.1)
- System.Memory (4.5.5)
- System.Runtime.CompilerServices.Unsafe (6.0.0)
- System.Text.Encodings.Web (8.0.0)
- System.Threading.Tasks.Extensions (4.5.4)
- System.Numerics.Vectors (4.5.0)
- System.ValueTuple (4.5.0)

## 界面预览

### 仪表盘布局

```
┌─────────────────────────────────────────────────────────────┐
│  ZTE Router Dashboard           Last Update: 14:23:45 ● Connected │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │ Network     │  │ Real-time   │  │ Traffic     │       │
│  │ Status      │  │ Speed       │  │ Statistics  │       │
│  │             │  │             │  │             │       │
│  │ IPv4: xxx   │  │ ↑ 87.2 KB/s │  │ Today: 1.2GB│       │
│  │ IPv6: xxx   │  │ ↓ 548.7KB/s │  │ Month: 15GB │       │
│  └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │
│  │ SIM Info    │  │ Signal      │  │ Devices     │       │
│  │             │  │ Strength    │  │             │       │
│  │ CMCC        │  │ SA (5G)     │  │    Total    │       │
│  │ sim ready   │  │ Band: n41   │  │      8      │       │
│  │ 8986***2345 │  │ RSRP:-85dBm │  │  WiFi: 6    │       │
│  └─────────────┘  └─────────────┘  └─────────────┘       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 待实现功能 (TODO)

### 高优先级

- [ ] 自动 session 创建/登录 (需要抓取 session API)
- [ ] 连接错误重试机制
- [ ] Session 过期自动刷新

### 中优先级

- [ ] 流量趋势图表
- [ ] 信号强度历史曲线
- [ ] 连接设备列表详情页面
- [ ] 路由器重启功能

### 低优先级

- [ ] WiFi 密码查看和修改
- [ ] 托盘图标和最小化
- [ ] 多语言支持
- [ ] 主题切换 (深色模式)

## 关键代码位置

### 修改路由器地址
- 文件: `AppSettings.cs`
- 位置: E:\.NET Ly\ZTE\AppSettings.cs:13

### 修改刷新间隔
- 文件: `AppSettings.cs`
- 位置: E:\.NET Ly\ZTE\AppSettings.cs:20

### 添加新的数据模型
- 文件夹: `Models/`
- 参考: `SpeedStat.cs`

### 添加新的 API 调用
- 文件: `HomeDashboardService.cs`
- 方法: `FetchDashboardDataAsync()`
- 位置: E:\.NET Ly\ZTE\Services\HomeDashboardService.cs:30

### 修改 UI 布局
- 文件: `MainWindow.xaml`
- 位置: E:\.NET Ly\ZTE\MainWindow.xaml:1

## 故障排查

### 问题: 应用启动后显示 "Error: ..."

**原因**: Session token 无效或路由器地址错误

**解决方案**:
1. 检查 `AppSettings.cs` 中的 `RouterUrl` 是否正确
2. 更新 `SessionToken` 为最新值
3. 确认路由器可访问 (ping 测试)

### 问题: 数据全部显示 "N/A"

**原因**: API 返回错误或数据格式不匹配

**解决方案**:
1. 查看状态栏的错误信息
2. 检查路由器固件版本是否支持这些 API
3. 对比设计方案中的 response 格式

### 问题: 编译错误 "找不到类型或命名空间"

**原因**: NuGet 包未正确还原

**解决方案**:
```bash
nuget restore "E:\.NET Ly\ZTE\ZTE.csproj"
```

## 性能优化建议

1. **降低刷新频率**: 如果不需要秒级刷新,可以将 `RefreshIntervalSeconds` 改为 5 或 10
2. **减少请求接口**: 注释掉不需要的 API 调用 (如 WiFi 配置)
3. **添加数据缓存**: 对于不常变的数据 (如 SIM 信息) 可以延长刷新间隔

## 参考资料

- 设计方案: `项目规划\设计方案.md`
- 使用说明: `README.md`
- Ubus 文档: OpenWrt ubus JSON-RPC

## 项目状态

✅ **已完成** - 所有核心功能已实现,应用可以正常运行

下一步建议: 抓取 session 创建接口,实现自动登录功能
