# ZTE Router Dashboard - 更新说明

## 🎉 重大更新：免登录模式 (2026-01-08)

### 新功能

#### ✨ 免登录访问
- **无需手动获取 Session Token**
- **使用固定 Session**: `00000000000000000000000000000000` (32个0)
- **Session 永不过期**
- **开箱即用，零配置**

### 更新内容

#### 1. 默认 Session Token 更新
**文件**: `AppSettings.cs`
```csharp
// 之前: 需要手动从浏览器获取
public static string SessionToken { get; set; } = "7dcd9bde9c28b3a32f9754593c01d027";

// 现在: 使用免登录模式
public static string SessionToken { get; set; } = "00000000000000000000000000000000";
```

#### 2. API 接口更新
**文件**: `Services\HomeDashboardService.cs`

使用新的未认证 API:

| 旧接口 | 新接口 | 说明 |
|--------|--------|------|
| zwrt_data / getbasicinfo | zwrt_zte_mdm.api / get_sim_info_before | SIM 信息 (登录前可访问) |
| zwrt_data / get_nrinfo | zte_nwinfo_api / nwinfo_get_netinfo | 网络信号信息 |
| zwrt_data / get_stanum | (已移除) | 设备数量需要登录 |
| zwrt_wifi / get_reportwifi | (已移除) | WiFi 配置需要登录 |
| (新增) | zwrt_router.api / router_get_status_no_auth | 路由器状态 (无需认证) |

#### 3. UI 优化
**文件**: `MainWindow.xaml`

- **移动状态信息到底部状态栏**
  - 之前: 状态显示在标题栏，空间有限，错误信息显示不完整
  - 现在: 移到底部状态栏，有足够空间显示完整的错误信息

- **添加最小窗口尺寸限制**
  - `MinWidth="900"` `MinHeight="600"`
  - 防止窗口过小导致内容重叠

#### 4. 修复编译错误
**文件**: `MainWindow.xaml.cs`, `ZTE.csproj`, `packages.config`

- ✅ 移除 `readonly` 关键字防止赋值错误
- ✅ 添加 `Microsoft.Bcl.AsyncInterfaces` 依赖包
- ✅ 修正 NuGet 包引用路径

### 使用对比

#### 之前的使用流程 ❌
```
1. 用 Visual Studio 打开项目
2. 打开浏览器访问路由器
3. F12 开发者工具
4. 找到 /ubus/ 请求
5. 复制 session 值
6. 粘贴到 AppSettings.cs
7. 编译运行
8. Session 过期后重复步骤 2-7
```

#### 现在的使用流程 ✅
```
1. 用 Visual Studio 打开项目
2. 按 F5 运行
3. 完成！
```

### 功能限制说明

#### 免登录模式可以访问：
- ✅ 网络连接状态
- ✅ SIM 卡基本信息
- ✅ 信号强度和网络类型
- ✅ 实时上传/下载速度
- ✅ 流量统计 (今日/本月/总计)
- ✅ WAN 接口状态 (IPv4/IPv6)

#### 免登录模式无法访问：
- ❌ 连接设备列表详情 (需要登录)
- ❌ WiFi 配置信息 (需要登录)
- ❌ 路由器设置修改 (需要登录)

**注**: 如需这些功能，可以手动配置真实的 Session Token

### 技术细节

#### 批量请求示例
```json
[
  {
    "jsonrpc": "2.0",
    "id": 1,
    "method": "call",
    "params": ["00000000000000000000000000000000", "zwrt_router.api", "router_get_status_no_auth", {}]
  },
  {
    "jsonrpc": "2.0",
    "id": 2,
    "method": "call",
    "params": ["00000000000000000000000000000000", "zwrt_zte_mdm.api", "get_sim_info_before", {}]
  },
  ...
]
```

#### 响应数据示例
```json
[
  {"jsonrpc": "2.0", "id": 1, "result": [0, {...}]},
  {"jsonrpc": "2.0", "id": 2, "result": [0, {...}]},
  ...
]
```

### 文件变更列表

| 文件 | 变更类型 | 说明 |
|------|----------|------|
| AppSettings.cs | 修改 | 默认 Session Token 改为免登录模式 |
| Services/HomeDashboardService.cs | 修改 | 使用新的未认证 API |
| MainWindow.xaml | 修改 | UI 优化，状态栏移到底部 |
| MainWindow.xaml.cs | 修改 | 移除 readonly，添加 null 检查 |
| ZTE.csproj | 修改 | 添加 Microsoft.Bcl.AsyncInterfaces 引用 |
| packages.config | 修改 | 添加 Microsoft.Bcl.AsyncInterfaces |
| 免登录模式说明.md | 新增 | 免登录功能详细说明 |
| 更新说明.md | 新增 | 本文件 |
| 快速开始.txt | 修改 | 简化使用步骤 |

### 升级指南

如果你已经在使用旧版本:

#### 方法 1: 重新克隆/下载
推荐直接使用最新版本。

#### 方法 2: 手动更新
1. 更新 `AppSettings.cs` 中的 Session Token 为 `00000000000000000000000000000000`
2. 更新 `Services/HomeDashboardService.cs` 使用新的 API 调用
3. 在 Visual Studio 中还原 NuGet 包

### 已知问题

无已知问题 ✅

### 下一步计划

- [ ] 添加登录模式切换功能 (可选)
- [ ] 添加设备列表页面 (需要登录)
- [ ] 添加 WiFi 配置页面 (需要登录)
- [ ] 添加流量趋势图表

### 相关文档

- **免登录模式详细说明**: `免登录模式说明.md`
- **快速开始指南**: `快速开始.txt`
- **完整使用说明**: `README.md`
- **编译指南**: `编译指南.md`

---

**版本**: 1.1.0
**更新日期**: 2026-01-08
**重要性**: 🔥 重大更新
**向后兼容**: ✅ 是
